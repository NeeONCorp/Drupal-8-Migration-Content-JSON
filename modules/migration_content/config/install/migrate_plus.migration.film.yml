id: migration_content_film10
label: 'JSON migration - Film rows'
migration_tags: null
migration_group: migrate_films

source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: json
  headers:
    Accept: 'application/json; charset=utf-8'
    Content-Type: 'application/json'
  urls: http://project2.local/films.json
  item_selector: films

  fields:
    -
      name: id
      label: 'ID'
      selector: id
    -
      name: title
      label: 'Title'
      selector: title
    -
      name: duration_minutes
      label: 'Duration (minutes)'
      selector: duration_minutes
    -
      name: iframe_url
      label: 'Iframe URL'
      selector: iframe_url
    -
      name: producer
      label: 'Producer'
      selector: producer
    -
      name: genres_ids
      label: 'Genres'
      selector: genres_ids
  ids:
    id:
      type: integer

destination:
  plugin: entity:node

process:
  type:
    plugin: default_value
    default_value: film

  title: title
  field_duration: duration_minutes
  field_iframe_url: iframe_url

  field_genre:
    plugin: iterator
    source: genres_ids
    process:
     temporary_ids:
       plugin: migration_lookup

       # Most likely the problem is in the string below,
       # but I do not know how to solve it yet.

       migration: migrate_genre
       source: genre_id
     target_id:
       plugin: extract
       source: '@temporary_ids'
       index:
         - 0
     target_revision_id:
       plugin: extract
       source: '@temporary_ids'
       index:
         - 1